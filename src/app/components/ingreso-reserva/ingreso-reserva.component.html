<div class="main-container">
  
  <button class="btn-volver" (click)="volver()">
    <i class="fas fa-arrow-left"></i> Volver
  </button>
  
  <div *ngIf="!usuarioConectado" class="login-warning-card">
    <div class="icon-warning">
      <i class="fas fa-user-lock"></i>
    </div>
    <h3>Acceso Restringido</h3>
    <p>Necesitas iniciar sesión para realizar una reserva.</p>
    <a routerLink="/login" class="btn-primary-action">Iniciar Sesión</a>
  </div>

  <div class="booking-card" *ngIf="usuarioConectado">
    
    <div class="card-header-title">
      <h2>Finalizar Reserva</h2>
      <p>Confirmá los detalles de tu partido</p>
    </div>
    
    <form (ngSubmit)="saveReserva()" #reservaForm="ngForm">

      <div class="info-grid">
        <div class="info-item">
            <span class="label">Reservando como</span>
            <div class="value-box">
                <i class="fas fa-user-circle"></i>
                {{ reserva.mail_cliente }}
            </div>
        </div>
        <div class="info-item">
            <span class="label">Cancha seleccionada</span>
            <div class="value-box">
                <i class="fas fa-futbol"></i>
                Cancha Nº {{ reserva.idCancha }}
            </div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="step-section">
        <label class="step-label">
            <span class="step-number">1</span> Elegí la fecha
        </label>
        
        <div class="date-input-wrapper">
          <input 
            type="date" 
            class="form-input-date" 
            id="fechaReserva" 
            [(ngModel)]="reserva.fechaReserva" 
            name="fechaReserva" 
            (change)="onFechaChange()" 
            [min]="fechaMinima"
            required 
          />
        </div>
      </div>

      <div class="step-section" *ngIf="reserva.fechaReserva">
        <label class="step-label">
            <span class="step-number">2</span> Seleccioná un horario
        </label>
        
        <div *ngIf="cargandoTurnos" class="loading-state">
           <div class="spinner"></div>
           <span>Buscando disponibilidad...</span>
        </div>

        <div *ngIf="!cargandoTurnos && turnosDisponibles.length === 0" class="empty-turnos">
           <i class="far fa-calendar-times"></i>
           <span>No quedan turnos disponibles para esta fecha.</span>
        </div>

        <div class="turnos-grid" *ngIf="!cargandoTurnos">
            <button 
                type="button" 
                *ngFor="let turno of turnosDisponibles"
                class="btn-turno"
                [class.selected]="turno === turnoSeleccionado"
                (click)="seleccionarTurno(turno)">
                {{ turno }}
            </button>
        </div>
      </div>

      <div class="summary-box" *ngIf="turnoSeleccionado">
        <div class="summary-icon"><i class="fas fa-check"></i></div>
        <div class="summary-details">
            <strong>Resumen:</strong>
            <span> Cancha {{reserva.idCancha}} • {{reserva.fechaReserva | date: 'dd/MM/yyyy'}} • {{reserva.horaInicio}}hs</span>
        </div>
      </div>

      <button type="submit" class="btn-submit" [disabled]="reservaForm.invalid || !turnoSeleccionado">
        Ir a Pagar (Seña 50%) <i class="fas fa-arrow-right"></i>
      </button>

    </form>

    <div *ngIf="reservaConfirmada" class="success-overlay">
      <div class="success-content">
        <i class="fas fa-check-circle"></i>
        <h3>¡Reserva Confirmada!</h3>
        <p>Te estamos redirigiendo...</p>
      </div>
    </div>

    <div *ngIf="!emailRegistrado" class="error-msg">
      ❌ Email no registrado. Intente nuevamente.
    </div>

  </div>
</div>